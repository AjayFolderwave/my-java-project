# Database properties for Profile Database
//jdbc.url2=jdbc:sqlserver://localhost:1433;databaseName=ProfileBeta;user=newuser;password=password
jdbc.url2=jdbc:sqlserver://localhost:1433;databaseName=ProfileBeta;user=newuser;password=password;encrypt=true;trustServerCertificate=true

jdbc.insert_sendGridContact=INSERT INTO dbo.sendGridContact (EMAIL, FIRST_NAME, LAST_NAME, ADDRESS_LINE_1, ADDRESS_LINE_2, CITY, STATE_PROVINCE_REGION, POSTAL_CODE, COUNTRY, ALTERNATE_EMAILS, PHONE_NUMBER, WHATSAPP, LINE, FACEBOOK, UNIQUE_NAME, CREATED_AT, UPDATED_AT, CONTACT_ID, IDOCEnabled, DocumentReceived, CBFinAidID, AwardYear, PreferredName, ProfileFileAvailable, ProfileSubmitDate, CSSID, OrganizationName, AwardYearText) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)

# Teams Webhook URL
teams.webhook_url=https://folderwaveinc.webhook.office.com/webhookb2/0673a619-66ea-445e-bfac-3c09eb2d850c@67b0f7e1-f362-487e-b7a2-5c8ebed3a46c/IncomingWebhook/51a4bc0f4fb84776aafd4711c90ff2ad/7812e428-721f-4fd0-b8e5-87166211add6

# ProfileDB SQL query for Reconciliation
profiledb.sql_query=CREATE TABLE #TBL (IDOCID VARCHAR(25), AWARDYEAR INTEGER, STARTDATE DATETIME, SUBMITDATE DATETIME, STUDENTEMAIL VARCHAR(150)); INSERT INTO #TBL(IDOCID, AWARDYEAR, STARTDATE, SUBMITDATE, STUDENTEMAIL) SELECT CBAPP.IDOCID IDOCID, APP.AWARDYEAR, MIN(APP.STARTDATE), MIN(SUB.SUBMITDATE), MAX(ISNULL(STDNTEMAIL.STUDENTEMAIL, APP.EMAIL)) FROM PROFILEBETA.DBO.APPLICATION APP WITH (NOLOCK) INNER JOIN PROFILEBETA.DBO.CBAPPLICATIONIDS CBAPP WITH (NOLOCK) ON CBAPP.APPLICATIONID = APP.APPLICATIONID AND CBAPP.HOUSEHOLDTYPE = 'HHA' LEFT JOIN (SELECT APPLICATIONID, MAX(APPSTDNT.EMAIL) STUDENTEMAIL, MAX(APPSTDNT.PREFERREDNAME) PREFERREDNAME FROM PROFILEBETA.dbo.APPLICATIONSTUDENT APPSTDNT WITH (NOLOCK) GROUP BY APPSTDNT.APPLICATIONID) STDNTEMAIL ON STDNTEMAIL.APPLICATIONID = APP.APPLICATIONID LEFT JOIN PROFILEBETA.DBO.APPLICATIONSCHOOLS APPLSCHL WITH (NOLOCK) ON APPLSCHL.APPLICATIONID = APP.APPLICATIONID LEFT JOIN PROFILEBETA.DBO.SUBMISSION SUB WITH (NOLOCK) ON SUB.APPLICATIONID = APP.APPLICATIONID WHERE APP.AWARDYEAR = '2025' AND SUB.APPLICATIONID IS NOT NULL GROUP BY CBAPP.IDOCID, APP.AWARDYEAR HAVING SUM(CASE WHEN APPLSCHL.APPLICATIONID IS NULL THEN 0 ELSE 1 END) >= 1; CREATE NONCLUSTERED INDEX [IDX_AWARDYEEAR_IDOCID] ON #TBL ([AWARDYEAR] ASC, [IDOCID] ASC) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]; SELECT T.IDOCID, MAX(T.SUBMITDATE) AS SUBMITDATE, MAX(AST.CBFINAIDID) AS CBFINAIDID FROM #TBL T LEFT JOIN CB_DW_BETA.SENDGRID.APPLICANTSTATUS AST ON AST.CBFINAIDID = T.IDOCID AND AST.AWARDYEAR = T.AWARDYEAR LEFT JOIN PROFILEBETA.dbo.sendGridContact SC ON SC.CBFINAIDID = T.IDOCID AND SC.AWARDYEAR = T.AWARDYEAR AND SC.EMAIL = T.STUDENTEMAIL LEFT JOIN CB_DW_BETA.STG.CBFINAID_ID_TEMPTBL CT ON CT.IDOCID = T.IDOCID WHERE SC.PROFILESUBMITDATE > '0001-01-01' AND AST.CBFINAIDID IS NOT NULL GROUP BY T.IDOCID ORDER BY MAX(T.SUBMITDATE) DESC;

#----------------------------------------------------------------------------------------------------------------------------------------------

# Database properties for IP Database
jdbc.url=jdbc:sqlserver://localhost:1433;databaseName=CBIntBeta;user=newuser;password=password;encrypt=true;trustServerCertificate=true
#jdbc.url = "jdbc:sqlserver://localhost:1433;databaseName=CBIntBeta;integratedSecurity=true;encrypt=true;trustServerCertificate=true";

jdbc.insert_sql=INSERT INTO dbo.sendGrididocContact (EMAIL, FIRST_NAME, LAST_NAME, ADDRESS_LINE_1, ADDRESS_LINE_2, CITY, STATE_PROVINCE_REGION, POSTAL_CODE, COUNTRY, ALTERNATE_EMAILS, PHONE_NUMBER, WHATSAPP, LINE, FACEBOOK, UNIQUE_NAME, CREATED_AT, UPDATED_AT, CONTACT_ID, IDOCEnabled, DocumentReceived, CBFinAidID, AwardYear, PreferredName, ProfileFileAvailable, ProfileSubmitDate, CSSID, OrganizationName, AwardYearText) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)

# SQL queries
sql.query1=DECLARE @OFFSET INTEGER = 5000; DECLARE @AWARDYEAR VARCHAR(25) = '2025'; DECLARE @IDOCDATERECEIVED_GUID UNIQUEIDENTIFIER; DECLARE @BEG_DATE DATETIME; DECLARE @END_DATE DATETIME; CREATE TABLE #FLD_TBL (FIELDID UNIQUEIDENTIFIER, TAGNAME VARCHAR(50), FOLDERSUBTYPE VARCHAR(50), FOLDERTYPE VARCHAR(50)); CREATE TABLE  #CASE_TBL (CASEGUID UNIQUEIDENTIFIER, STUDENTGUID UNIQUEIDENTIFIER, AWYEAR INTEGER, CASESTATUS VARCHAR(50), CRDATETIME DATETIME, STDNTFIRSTNAME VARCHAR(150), STDNTLASTNAME VARCHAR(150), STDNTEMAIL VARCHAR(150), CBFINAIDID VARCHAR(50), STDNTPREFERNAME VARCHAR(150), IDOCENABLED VARCHAR(50), IDOCENABLEDDATE DATETIME, PAR1FIRSTNAME VARCHAR(150), PAR1LASTNAME VARCHAR(150), PAR1EMAIL VARCHAR(150), PAR2FIRSTNAME VARCHAR(150), PAR2LASTNAME VARCHAR(150), PAR2EMAIL VARCHAR(150), IDOCDATERECEIVED DATETIME); SELECT @IDOCDATERECEIVED_GUID = CF.FIELDID FROM COLUMNFIELD CF WITH (NOLOCK) WHERE TAGNAME = 'IDOCDateReceived' AND CF.FOLDERTYPE = 'STUCASE' AND CF.FOLDERSUBTYPE = 'APPLSTATREPORT'; INSERT INTO #FLD_TBL (FIELDID, TAGNAME, FOLDERTYPE, FOLDERSUBTYPE) SELECT CF.FIELDID, CF.TAGNAME, CF.FOLDERTYPE, CF.FOLDERSUBTYPE FROM COLUMNFIELD CF WITH (NOLOCK) WHERE (FOLDERTYPE = 'STUDENT' AND FOLDERSUBTYPE = 'STUINFO' AND TAGNAME IN ('FIRSTNAME', 'LASTNAME', 'EMAIL1', 'IDOCID', 'PREFERREDNAME')) OR (FOLDERTYPE = 'STUCASE' AND FOLDERSUBTYPE IN ('IDOCINFO','PARINFO', 'APPLSTATREPORT') AND TAGNAME IN ('IDOCENABLED', 'PARFIRSTNAME1', 'PARLASTNAME1', 'PAREMAIL1', 'PARFIRSTNAME2', 'PARLASTNAME2', 'PAREMAIL2', 'IDOCDATERECEIVED')); INSERT INTO #CASE_TBL(CASEGUID, STUDENTGUID, AWYEAR, CASESTATUS, CRDATETIME) SELECT FLD.FOLDERID CASEGUID, FLD.PARENTFOLDERID STUDENTGUID, FLD.YEAR AWYEAR, FLD.STATUS CASESTATUS, FLD.CRDATETIME CRDATETIME FROM CASEINFO CI WITH (NOLOCK) INNER JOIN FOLDER FLD WITH (NOLOCK) ON FLD.FOLDERID = CI.FOLDERID WHERE CI.FIELDID = @IDOCDATERECEIVED_GUID AND FLD.YEAR = @AWARDYEAR AND CAST(ISNULL(CI.VALUE1, '1900-01-01') AS DATE) <> '1900-01-01'; CREATE NONCLUSTERED INDEX [IDX_CASEGUID_STUDENTGUID] ON #CASE_TBL ([CASEGUID] ASC, [STUDENTGUID] ASC)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]; UPDATE #CASE_TBL SET IDOCENABLED = CASES.IDOCENABLED, PAR1FIRSTNAME = CASES.PARFIRSTNAME1, PAR1LASTNAME = CASES.PARLASTNAME1, PAR1EMAIL = CASES.PAREMAIL1, PAR2FIRSTNAME = CASES.PARFIRSTNAME2, PAR2LASTNAME = CASES.PARLASTNAME2, PAR2EMAIL = CASES.PAREMAIL2, IDOCDATERECEIVED = CASES.IDOCDATERECEIVED FROM #CASE_TBL CT INNER JOIN (SELECT FOLDERID, MAX(IDOCDateReceived) IDOCDateReceived, MAX(IDOCEnabled) IDOCEnabled, MAX(ParEmail1) ParEmail1, MAX(ParEmail2) ParEmail2, MAX(ParFirstName1) ParFirstName2, MAX(ParLastName1) ParLastName2 FROM (SELECT FOLDERID, IDOCDateReceived, IDOCEnabled, ParEmail1, ParEmail2, ParFirstName1, ParFirstName2, ParLastName1, ParLastName2, Email1, Firstname, IDOCID, Lastname, PreferredName FROM (SELECT CI.FOLDERID, CI.FIELDID, FLDS.TAGNAME, CI.VALUE1 FROM CASEINFO CI WITH (NOLOCK) INNER JOIN #FLD_TBL FLDS ON FLDS.FIELDID = CI.FIELDID INNER JOIN #CASE_TBL CASELIST ON CASELIST.CASEGUID = CI.FOLDERID) P PIVOT (MAX(VALUE1) FOR TAGNAME IN (IDOCDateReceived, IDOCEnabled, ParEmail1, ParEmail2, ParFirstName1, ParFirstName2, ParLastName1, ParLastName2, Email1, Firstname, IDOCID, Lastname, PreferredName)) AS PVT) CASES GROUP BY FOLDERID) CASES ON CASES.FOLDERID = CT.CASEGUID; UPDATE #CASE_TBL SET IDOCENABLEDDATE = IDDOC.IDOCENABLEDDATE FROM #CASE_TBL CT WITH (NOLOCK) INNER JOIN (SELECT DOC.FOLDERID, MIN(MODDATETIME) IDOCENABLEDDATE FROM DOCUMENT DOC WITH (NOLOCK) WHERE DOC.DOCTYPE = 'CB_FA_IDOCENABLED' AND DOC.STATUS = 'Processed' GROUP BY DOC.FOLDERID) IDDOC ON IDDOC.FOLDERID = CT.CASEGUID; UPDATE #CASE_TBL SET STDNTEMAIL= CASES.EMAIL1, STDNTFIRSTNAME = CASES.FIRSTNAME, STDNTLASTNAME= CASES.LASTNAME, STDNTPREFERNAME = CASES.PREFERREDNAME, CBFINAIDID = CASES.IDOCID FROM #CASE_TBL CT INNER JOIN (SELECT FOLDERID, MAX(Email1) Email1, MAX(Firstname) Firstname, MAX(IDOCID) IDOCID, MAX(Lastname) Lastname, MAX(PreferredName) PreferredName FROM (SELECT FOLDERID, IDOCDateReceived, IDOCEnabled, ParEmail1, ParEmail2, ParFirstName1, ParFirstName2, ParLastName1, ParLastName2, Email1, Firstname, IDOCID, Lastname, PreferredName FROM (SELECT SI.FOLDERID, SI.FIELDID, FLDS.TAGNAME, SI.VALUE1 FROM STUDENTINFO SI WITH (NOLOCK) INNER JOIN #FLD_TBL FLDS ON FLDS.FIELDID = SI.FIELDID INNER JOIN #CASE_TBL CASELIST ON CASELIST.STUDENTGUID = SI.FOLDERID) P PIVOT (MAX(VALUE1) FOR TAGNAME IN (IDOCDateReceived, IDOCEnabled, ParEmail1, ParEmail2, ParFirstName1, ParFirstName2, ParLastName1, ParLastName2, Email1, Firstname, IDOCID, Lastname, PreferredName)) AS PVT) CASES GROUP BY FOLDERID) CASES ON CASES.FOLDERID = CT.STUDENTGUID; TRUNCATE TABLE CB_DW_BETA.STG.IDOCDATERCVD_COMPLETE; INSERT INTO CB_DW_BETA.STG.IDOCDATERCVD_COMPLETE (CBFINAIDID, CASECOUNT, AWARDYEAR, EARLIESTCRDATETIME, STUDENTFIRSTNAME, STUDENTLASTNAME, STUDENTEMAILADDRESS, STDNTPREFERNAME, IDOCENABLED, IDOCENABLEDDATE, PARENT1FIRSTNAME, PARENT1LASTNAME, PARENT1EMAIL, PARENT2FIRSTNAME, PARENT2LASTNAME, PARENT2EMAIL, IDOCDATERECEIVED) SELECT CT.CBFINAIDID CBFINAIDID, COUNT(CT.CASEGUID) CASECOUNT, CT.AWYEAR AWARDYEAR, MIN(CT.CRDATETIME) EARLIESTCRDATETIME, ISNULL(MAX(CT.STDNTFIRSTNAME), '') STUDENTFIRSTNAME, ISNULL(MAX(CT.STDNTLASTNAME), '') STUDENTLASTNAME, ISNULL(MAX(CT.STDNTEMAIL), '') STUDENTEMAILADDRESS, ISNULL(MAX(CT.STDNTPREFERNAME), '') STUDENTPREFNAME, ISNULL(MAX(CT.IDOCENABLED), '') IDOCENABLED, ISNULL(MAX(CT.IDOCENABLEDDATE), '9999-12-31') IDOCENABLEDDATE, ISNULL(MAX(CT.PAR1FIRSTNAME), '') PARENT1FIRSTNAME, ISNULL(MAX(CT.PAR1LASTNAME), '') PARENT1LASTNAME, ISNULL(MAX(CT.PAR1EMAIL), '') PARENT1EMAIL, ISNULL(MAX(CT.PAR2FIRSTNAME), '') PARENT2FIRSTNAME, ISNULL(MAX(CT.PAR2LASTNAME), '') PARENT2LASTNAME, ISNULL(MAX(CT.PAR2EMAIL), '') PARENT2EMAIL, CAST(ISNULL(MAX(CT.IDOCDATERECEIVED), '9999-12-31') AS DATETIME) IDOCDATERECEIVED FROM #CASE_TBL CT GROUP BY CT.CBFINAIDID, CT.AWYEAR HAVING CT.CBFINAIDID <> ''

sql.query2=UPDATE CBIntBeta.DBO.SENDGRIDIDOCCONTACT SET AWARDYEAR = '2025' WHERE CAST(AWARDYEAR AS VARCHAR(25)) = '24-25'; SELECT SUM(CASE WHEN SIC.DOCUMENTRECEIVED = '0001-01-01' THEN 1 ELSE 0 END) AS TOTAL_MISSING_DOCRCVD_DT, SUM(CASE WHEN DATEDIFF(DAY, IDC.IDOCENABLEDDATE, GETDATE()) <= 25 AND SIC.DOCUMENTRECEIVED = '0001-01-01' THEN 1 ELSE 0 END) AS AT_RISK, SUM(CASE WHEN CAST(IDC.IDOCDATERECEIVED AS DATE) = CAST(GETDATE() AS DATE) THEN 1 ELSE 0 END) AS TODAY_DOC_RECVD, SUM(CASE WHEN CAST(IDC.IDOCDATERECEIVED AS DATE) = CAST(GETDATE() AS DATE) AND SIC.DOCUMENTRECEIVED = '0001-01-01' THEN 1 ELSE 0 END) AS TODAY_AT_RISK, MIN(DATEDIFF(DAY, '2024-01-01', GETDATE())) AS MIN_DAYS_FROM_2024, SUM(CASE WHEN SIC.EMAIL IS NULL THEN 1 ELSE 0 END) AS NULL_EMAILS FROM CB_DW_BETA.STG.IDOCDATERCVD_COMPLETE IDC LEFT JOIN CBIntBeta.DBO.SENDGRIDIDOCCONTACT SIC ON SIC.CBFINAIDID = IDC.CBFINAIDID AND SIC.AWARDYEAR = IDC.AWARDYEAR AND SIC.EMAIL = IDC.STUDENTEMAILADDRESS


#----------------------------------------------------------------------------------------------------------------------------------------------


# properties file
personId.sql_query=\
SELECT DISTINCT FormUser.Firstname, FormUser.Lastname, FormUser.RegisteredDate \
FROM FormUser \
INNER JOIN CBApplicationIDs ON FormUser.IDOCId = CBApplicationIDs.IDOCID \
INNER JOIN Application ON Application.ApplicationId = CBApplicationIDs.ApplicationId \
INNER JOIN ApplicationSchools ON ApplicationSchools.ApplicationId = CBApplicationIDs.ApplicationId \
WHERE FormUser.CBPersonId = '' \
AND CBApplicationIds.AwardYear = '2025' \
AND Application.Revision = '0' \
AND ApplicationSchools.CSSCode != '5024' \
AND ApplicationSchools.CSSCode != '5025' \
AND FormUser.Email = FormUser.Username \
ORDER BY FormUser.RegisteredDate DESC
